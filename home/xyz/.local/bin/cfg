#!/bin/sh

# didn't consider $HOME contain space? need improve?
while getopts clLsSmM opt; do
	case $opt in
		c)		dir="$HOME"
				cmd="git --git-dir=$dir/.cfg$opt/ --work-tree=$dir"
				mods="$XDG_CONFIG_HOME/myconf/cfg${opt}_meta";;
		l|s)	dir=/
				cmd="sudo git --git-dir=/etc/.cfg$opt/ --work-tree=/"
				mods="/etc/myconf/cfg${opt}_meta";;
				# -rw-r--r-- == binary 110100100 == octal 644
				# https://stackoverflow.com/a/1796009
		m)		sudo gitmetap "$cmd ls-tree -r --name-only --full-tree HEAD" "$dir" "$mods"
				exit;;
		M)		sudo gitmetar "$mods"
				exit;;
		\?)	exit 1;;
	esac
done
shift $((OPTIND-1))
$cmd "$@"
